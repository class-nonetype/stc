<section class="inbox-container">

  <div class="filter-actions-row">
    <div class="filter-menu-bar">
      <button mat-stroked-button color="primary" (click)="openFilters()" aria-label="Mostrar filtros">
        <mat-icon aria-hidden="true">filter_list</mat-icon>
        <span>Filtros</span>
      </button>
    </div>

    <mat-paginator
      class="inbox-paginator"
      [length]="filteredTickets().length"
      [pageIndex]="pageIndex()"
      [pageSize]="pageSize()"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)"
      showFirstLastButtons
      aria-label="Paginacion de tickets"
    ></mat-paginator>
  </div>

  <div class="inbox-results">
    @if (loading()) {
      <div class="inbox-skeleton" role="presentation" aria-hidden="true">
        <div class="s-row"></div>
        <div class="s-row"></div>
        <div class="s-row"></div>
      </div>
    } @else if (hasError()) {
      <div class="inbox-error" role="alert">
        <div class="inbox-error-content">
          <h2 class="inbox-error-title">No pudimos cargar los tickets</h2>
          <p>Revisa tu conexion e intentalo nuevamente.</p>
        </div>
        <button type="button" class="inbox-error-action" (click)="onRetry()">Reintentar</button>
      </div>
    } @else if (!tickets().length) {
      <div class="inbox-empty" role="status">
        <div class="inbox-empty-icon">
          <mat-icon aria-hidden="true">assignment_late</mat-icon>
        </div>
        <p class="inbox-empty-message">Sin tickets pendientes</p>

        <!-- <p class="inbox-empty-hint">Todo esta en orden por ahora.</p> -->
      </div>
    } @else {
      <mat-list class="inbox-list" aria-label="Bandeja de tickets">
        @for (ticket of visibleTickets(); track ticket.id) {
          @if ( getCurrentUserTeam() === 'Asesoría'
                || (getCurrentUserTeam() == 'Soporte'
                    && getCurrentUserId() === ticket.managerId
                    || !ticket.managerId)
          ){
            <button
              mat-list-item
              disableRipple
              class="inbox-card-item"
              type="button"
              (click)="onOpen(ticket)"
            >
              <div
                class="inbox-card"
                [class.inbox-card--unread]="isUnread(ticket)"
              >
                <div class="inbox-card-icon" aria-hidden="true">
                  <mat-icon>{{ isUnread(ticket) ? 'mark_email_unread' : 'drafts' }}</mat-icon>
                </div>

                <div class="inbox-card-content">

                  <h2 class="inbox-card-title">{{ titleLabel(ticket) }}</h2>

                  <div class="inbox-card-pills">
                    <span class="inbox-card-code">{{ ticket.code }}</span>
                    <span
                      class="inbox-card-priority"
                      [class.inbox-card-priority--low]="priorityKey(ticket) === 'low'"
                      [class.inbox-card-priority--medium]="priorityKey(ticket) === 'medium'"
                      [class.inbox-card-priority--high]="priorityKey(ticket) === 'high'"
                      [class.inbox-card-priority--critical]="priorityKey(ticket) === 'critical'"
                    >
                      {{ ticket.priority }}
                    </span>
                    <span class="inbox-card-status">{{ statusLabel(ticket) }}</span>
                  </div>

                  <div class="inbox-card-footer">
                    <span class="inbox-card-footer-left">
                      {{ getManagerFullName(ticket) }} | {{ requesterLabel(ticket) }}
                    </span>

                    <span class="inbox-card-footer-right">

                      @if ( ticket.manager ){
                        <mat-icon
                          aria-hidden="true"
                          [title]="ticket.manager || 'Sin encargado'"
                        >how_to_reg</mat-icon>
                      }

                      <mat-icon
                        aria-hidden="true"
                        [matTooltip]="'Creado: ' + (ticket.createdAt || 'Sin fecha')"
                      >event</mat-icon>
                      <mat-icon
                        aria-hidden="true"
                        [matTooltip]="'Actualizado: ' + (ticket.updatedAt || 'Sin fecha')"
                      >update</mat-icon>
                    </span>
                  </div>

                </div>
              </div>
            </button>
          }

        }
      </mat-list>
    }
  </div>
</section>
